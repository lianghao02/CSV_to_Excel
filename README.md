# CSV 轉 Excel 工具（V4.5.1）

將多個 CSV 檔快速轉為 Excel（支援合併、分頁、自動格式），專為台灣常見 CSV（UTF-8/Big5）與金融欄位設計。

## 特色
- **自動編碼偵測**：UTF-8 / Big5 / GB18030，避免亂碼。
- **金額欄位格式化**：`支出金額 / 存入金額 / 餘額` 會去除 `+` 與小數、截斷為整數，Excel 以 `#,##0` 顯示。
- **跨檔統計**：即時顯示支出/存入/餘額合計。
- **避免科學記號**：常見長號碼欄以文字格式輸出（`z='@'`）。
- **分頁模式**：
  1. **原模式**：可選「合併成一個 Excel（每檔一分頁）」或逐檔輸出。
  2. **依標題合併模式**：**先規格化標題**再分群；**同組放同一分頁**（分頁名 001、002…），不同來源以**空白列**分隔。
- **可稽核**：輸出 `000_HeaderMap` 分頁，記錄每個來源檔 **原始標題 → 規格化後標題** 與其分頁/簽名。

## 關鍵規則（本版新增/強化）
- **戶名 ≠ 帳號**：
  - `戶名` 表示**開戶人名稱**；`帳號` 表示**金融帳號**。
  - 若欄名同時出現「帳號/戶名」等混合字樣，**一律歸到「帳號」**（避免把姓名誤認為帳號）。
- **承租人 與 被害人**：**不合併**。但 `被害人` 與 `受害人` 仍合併為「被害人」。
- **資料提供日帳戶餘額 / 資料提供日帳戶結餘**：**合併為同一欄**，統一名稱：**資料提供日帳戶結餘**。
- **「端未機/端末機」等常見錯別字**：自動修正為 **ATM或端末機代碼**。
- **寬鬆比對**：去除空白、全形轉半形、去括號說明、正規化標點；若仍不一致，使用**編輯距離 ≤ 2** 的近似比對。

## 使用方式
1. 開啟 `index.html`（會自動導向到最新版頁面）。
2. 直接拖曳 CSV 檔或資料夾，或按「選擇 CSV / 資料夾」挑選。
3. 選擇模式：
   - **開始轉換（原模式）**：逐檔輸出（或勾選「合併成一個 Excel」→ 每檔一分頁）。
   - **依標題合併成分頁**：將「規格化後標題相同」的 CSV 合併到同一分頁（分頁名 001/002…），不同來源中間會加**空白列**分隔。
4. 完成後下載 Excel；可在 `000_HeaderMap` 分頁檢視各檔標題對照與分頁歸屬。

## 欄位規格化（部分對照）
- `端未機 / 端末機 / ATM/端末機代碼` → **ATM或端末機代碼**
- `身分證統編號 / 身份證統編號 / 身分證號` → **身分證統一編號**
- `資料提供日 / 資料提供日期` → **資料提供日期**
- `資料提供日帳戶餘額 / 資料提供日帳戶結餘 / 資料提供日期帳戶結餘` → **資料提供日帳戶結餘**
- `交易行(或所屬分行代號)` → **交易行**
- `開戶行總、分支機構代碼` → **開戶行總分支機構代碼**
- `帳戶名稱 / 開戶人名稱 / 客戶名稱` → **戶名**（不會併到**帳號**）
- `被害人 / 受害人` → **被害人**（**承租人**不會併入）

> 若有新的欄名變體，可在 `app.js` 的 `HEADER_ALIASES` 內擴充（或告訴我，我幫你補）。

## 技術細節
- 解析：PapaParse（`header: true, skipEmptyLines: 'greedy'`）
- 輸出：SheetJS（XLSX），自動欄寬、AutoFilter、金額格式 `#,##0`
- 編碼偵測：用 `TextDecoder` 嘗試 `UTF-8 → Big5 → GB18030`，依中文字比例與替代字 `�` 打分選最佳
- 數值判斷：對非金額欄，若該欄 >80% 非空值可解析為數字，則以數值輸出；否則以文字輸出

## 版本記錄
- **4.5.1**：
  - 標題規格化後再分群；輸出 `000_HeaderMap`。
  - 規則強化：**戶名 ≠ 帳號**；**承租人**與**被害人**不合併；**資料提供日帳戶餘額/結餘**合併。
- **4.5.0**：新增「依標題合併成分頁」模式，分頁名 001/002…，不同來源以空白行分隔。
- **4.4.4**：自動偵測 CSV 編碼（UTF-8/Big5/GB18030），修正亂碼；保留金額整形與統計。

## 常見問題
- **有欄位叫「帳號/戶名」怎麼辦？**  
  會被規格化成 **帳號**（避免把姓名混進帳號欄）。若你確定那欄其實是姓名，建議在 CSV 源頭改名成「戶名」。
- **同檔有兩欄 `交易日期`？**  
  規格化簽名前會**去重**（保留第一個），避免同一檔造成分群被拆；輸出仍只保留第一個。
- **某些超生僻寫法沒有被併入？**  
  請提供原始標題，我會幫你加入 `HEADER_ALIASES`，或你自行於該表擴充。

## 授權
個人/內部可自由使用；若要二次散布或商用，請保留版本標示與本說明。

