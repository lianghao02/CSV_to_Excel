# 🚀 CSV 轉 Excel 工具 (V4.5.1)

將多個 CSV 檔案快速轉換為結構化的 Excel 報表（支援合併、分頁、自動格式化），專為處理**台灣常見編碼 (UTF-8/Big5)** 與**金融資料**欄位設計。

## ✨ 核心特色

* **自動編碼偵測：** 智慧判讀 UTF-8 / Big5 / GB18030，徹底解決中文亂碼問題。
* **金融欄位格式化：** 自動處理 `支出金額 / 存入金額 / 餘額`，去除 `+`、逗號與小數，Excel 中顯示為**標準貨幣格式 `#,#\#0`**。
* **長號碼防呆：** 偵測長串數字（如帳號、身分證號），強制以**文字格式 (`z='@'`)** 輸出，避免科學記號顯示錯誤。
* **即時跨檔統計：** 轉換過程中，即時顯示所有檔案的支出、存入、餘額**合計數**。
* **高度可稽核性：** 輸出 `000_HeaderMap` 分頁，詳實記錄每個來源檔的 **原始標題 → 規格化後標題** 與其所屬的分頁名稱，便於追蹤資料來源。

---

## ⚙️ 欄位規格化與關鍵規則（V4.5.1 強化）

本工具的核心在於對台灣常見、但不統一的欄位名稱進行**自動歸一化**，確保資料能準確合併。

### 強化規則重點

* **嚴格區分「戶名」與「帳號」：**
    * `戶名` 歸屬於**開戶人姓名**；`帳號` 歸屬於**金融帳號**。
    * **特殊情況：** 若欄位名同時出現「帳號/戶名」等混合字樣，將**一律歸到「帳號」**，避免姓名被誤認為帳號。
* **特定欄位不合併：** `承租人` **不會**與 `被害人/受害人` 合併，確保法務資料的獨立性。
* **結餘欄位統一：** `資料提供日帳戶餘額` 與 `資料提供日帳戶結餘` **合併**，統一名稱：**資料提供日帳戶結餘**。
* **自動錯字修正：** 自動修正如「端未機/端末機」等常見錯誤為 **ATM或端末機代碼**。
* **寬鬆比對機制：** 採用**編輯距離（Levenshtein Distance）≤ 2** 的近似比對，同時會先去除空白、全形轉半形、去括號說明，以提高匹配率。

### 部分欄位對照表

| 原始欄位範例 | 規格化後欄位名稱 | 備註 |
| :--- | :--- | :--- |
| `端未機 / 端末機 / ATM/端末機代碼` | **ATM或端末機代碼** | 自動錯字修正 |
| `身分證統編號 / 身份證號` | **身分證統一編號** | 欄名統一 |
| `帳戶名稱 / 開戶人名稱 / 客戶名稱` | **戶名** | **不併入帳號** |
| `資料提供日帳戶餘額 / 資料提供日帳戶結餘` | **資料提供日帳戶結餘** | 餘額與結餘統一 |
| `被害人 / 受害人` | **被害人** | `承租人` 不併入 |
| `交易行(或所屬分行代號)` | **交易行** | 去除括號說明 |

---

## 💻 使用方式

1.  開啟 `index.html` (或 `CSVtoExcel_V4.5.1.html`)。
2.  將 CSV 檔案或整個資料夾**拖曳**到藍色框內，或點擊 **「選擇檔案/資料夾」** 按鈕選取。
3.  選擇轉換模式：
    * **原模式：** 可選「合併成一個 Excel (每檔一分頁)」或逐檔輸出。
    * **依標題合併成分頁：** **先規格化標題**，將「標題組合相同」的 CSV 合併到同一 Excel 分頁（分頁名 001, 002...），不同來源之間以**空白列**分隔。
4.  完成後下載 Excel 檔。建議開啟 `000_HeaderMap` 分頁，檢視所有檔案的標題對照與分頁歸屬。

## ❓ 常見問題 Q&A

**Q: 檔案裡有欄位叫「帳號/戶名」怎麼辦？**
A: 該欄位會被規格化成 **帳號**。這是為了防止重要金融帳號欄位被意外混入戶名（姓名）欄。若您確定該欄應為姓名，建議在 CSV 源頭將其改名為「戶名」。

**Q: 轉換流程失敗或輸出有問題？**
A: 請檢查底部的「日誌輸出」區，並點擊 **「📋 複製日誌」** 按鈕，提供完整的日誌訊息以便除錯。

**Q: 某些生僻或新的欄名變體無法自動合併？**
A: 請提供原始標題給我。我會將其加入 `app.js` 內的 `HEADER_ALIASES` 中，以擴充未來的識別能力。

## 📜 授權

個人或內部使用可自由使用。若需二次散布或商用，請務必保留版本標示與本說明文件。